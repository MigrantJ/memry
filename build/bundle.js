var duScrollDefaultEasing=function(e){"use strict";return.5>e?Math.pow(2*e,2)/2:1-Math.pow(2*(1-e),2)/2};angular.module("duScroll",["duScroll.scrollspy","duScroll.smoothScroll","duScroll.scrollContainer","duScroll.spyContext","duScroll.scrollHelpers"]).value("duScrollDuration",350).value("duScrollSpyWait",100).value("duScrollGreedy",!1).value("duScrollOffset",0).value("duScrollEasing",duScrollDefaultEasing),angular.module("duScroll.scrollHelpers",["duScroll.requestAnimation"]).run(["$window","$q","cancelAnimation","requestAnimation","duScrollEasing","duScrollDuration","duScrollOffset",function(e,t,n,r,o,l,i){"use strict";var u={},c=function(e){return"undefined"!=typeof HTMLDocument&&e instanceof HTMLDocument||e.nodeType&&e.nodeType===e.DOCUMENT_NODE},a=function(e){return"undefined"!=typeof HTMLElement&&e instanceof HTMLElement||e.nodeType&&e.nodeType===e.ELEMENT_NODE},d=function(e){return a(e)||c(e)?e:e[0]};u.duScrollTo=function(t,n,r){var o;if(angular.isElement(t)?o=this.duScrollToElement:r&&(o=this.duScrollToAnimated),o)return o.apply(this,arguments);var l=d(this);return c(l)?e.scrollTo(t,n):(l.scrollLeft=t,void(l.scrollTop=n))};var s,f;u.duScrollToAnimated=function(e,l,i,u){i&&!u&&(u=o);var c=this.duScrollLeft(),a=this.duScrollTop(),d=Math.round(e-c),p=Math.round(l-a),m=null,g=this,S="scroll mousedown mousewheel touchmove keydown",y=function(e){(!e||e.which>0)&&(g.unbind(S,y),n(s),f.reject(),s=null)};if(s&&y(),f=t.defer(),!d&&!p)return f.resolve(),f.promise;var h=function(e){null===m&&(m=e);var t=e-m,n=t>=i?1:u(t/i);g.scrollTo(c+Math.ceil(d*n),a+Math.ceil(p*n)),1>n?s=r(h):(g.unbind(S,y),s=null,f.resolve())};return g.duScrollTo(c,a),g.bind(S,y),s=r(h),f.promise},u.duScrollToElement=function(e,t,n,r){var o=d(this);(!angular.isNumber(t)||isNaN(t))&&(t=i);var l=this.duScrollTop()+d(e).getBoundingClientRect().top-t;return a(o)&&(l-=o.getBoundingClientRect().top),this.duScrollTo(0,l,n,r)},u.duScrollLeft=function(t,n,r){if(angular.isNumber(t))return this.duScrollTo(t,this.duScrollTop(),n,r);var o=d(this);return c(o)?e.scrollX||document.documentElement.scrollLeft||document.body.scrollLeft:o.scrollLeft},u.duScrollTop=function(t,n,r){if(angular.isNumber(t))return this.duScrollTo(this.duScrollLeft(),t,n,r);var o=d(this);return c(o)?e.scrollY||document.documentElement.scrollTop||document.body.scrollTop:o.scrollTop},u.duScrollToElementAnimated=function(e,t,n,r){return this.duScrollToElement(e,t,n||l,r)},u.duScrollTopAnimated=function(e,t,n){return this.duScrollTop(e,t||l,n)},u.duScrollLeftAnimated=function(e,t,n){return this.duScrollLeft(e,t||l,n)},angular.forEach(u,function(e,t){angular.element.prototype[t]=e;var n=t.replace(/^duScroll/,"scroll");angular.isUndefined(angular.element.prototype[n])&&(angular.element.prototype[n]=e)})}]),angular.module("duScroll.polyfill",[]).factory("polyfill",["$window",function(e){"use strict";var t=["webkit","moz","o","ms"];return function(n,r){if(e[n])return e[n];for(var o,l=n.substr(0,1).toUpperCase()+n.substr(1),i=0;i<t.length;i++)if(o=t[i]+l,e[o])return e[o];return r}}]),angular.module("duScroll.requestAnimation",["duScroll.polyfill"]).factory("requestAnimation",["polyfill","$timeout",function(e,t){"use strict";var n=0,r=function(e){var r=(new Date).getTime(),o=Math.max(0,16-(r-n)),l=t(function(){e(r+o)},o);return n=r+o,l};return e("requestAnimationFrame",r)}]).factory("cancelAnimation",["polyfill","$timeout",function(e,t){"use strict";var n=function(e){t.cancel(e)};return e("cancelAnimationFrame",n)}]),angular.module("duScroll.spyAPI",["duScroll.scrollContainerAPI"]).factory("spyAPI",["$rootScope","$timeout","scrollContainerAPI","duScrollGreedy","duScrollSpyWait",function(e,t,n,r,o){"use strict";var l=function(n){var l=!1,i=!1,u=function(){i=!1;var t=n.container,o=t[0],l=0;("undefined"!=typeof HTMLElement&&o instanceof HTMLElement||o.nodeType&&o.nodeType===o.ELEMENT_NODE)&&(l=o.getBoundingClientRect().top);var u,c,a,d,s,f;for(d=n.spies,c=n.currentlyActive,a=void 0,u=0;u<d.length;u++)s=d[u],f=s.getTargetPosition(),f&&f.top+s.offset-l<20&&-1*f.top+l<f.height&&(!a||a.top<f.top)&&(a={top:f.top,spy:s});a&&(a=a.spy),c===a||r&&!a||(c&&(c.$element.removeClass("active"),e.$broadcast("duScrollspy:becameInactive",c.$element)),a&&(a.$element.addClass("active"),e.$broadcast("duScrollspy:becameActive",a.$element)),n.currentlyActive=a)};return o?function(){l?i=!0:(u(),l=t(function(){l=!1,i&&u()},o,!1))}:u},i={},u=function(e){var t=e.$id,n={spies:[]};return n.handler=l(n),i[t]=n,e.$on("$destroy",function(){c(e)}),t},c=function(e){var t=e.$id,n=i[t],r=n.container;r&&r.off("scroll",n.handler),delete i[t]},a=u(e),d=function(e){return i[e.$id]?i[e.$id]:e.$parent?d(e.$parent):i[a]},s=function(e){var t,n,r=e.$element.scope();if(r)return d(r);for(n in i)if(t=i[n],-1!==t.spies.indexOf(e))return t},f=function(e){for(;e.parentNode;)if(e=e.parentNode,e===document)return!0;return!1},p=function(e){var t=s(e);t&&(t.spies.push(e),t.container&&f(t.container)||(t.container&&t.container.off("scroll",t.handler),t.container=n.getContainer(e.$element.scope()),t.container.on("scroll",t.handler).triggerHandler("scroll")))},m=function(e){var t=s(e);e===t.currentlyActive&&(t.currentlyActive=null);var n=t.spies.indexOf(e);-1!==n&&t.spies.splice(n,1),e.$element=null};return{addSpy:p,removeSpy:m,createContext:u,destroyContext:c,getContextForScope:d}}]),angular.module("duScroll.scrollContainerAPI",[]).factory("scrollContainerAPI",["$document",function(e){"use strict";var t={},n=function(e,n){var r=e.$id;return t[r]=n,r},r=function(e){return t[e.$id]?e.$id:e.$parent?r(e.$parent):void 0},o=function(n){var o=r(n);return o?t[o]:e},l=function(e){var n=r(e);n&&delete t[n]};return{getContainerId:r,getContainer:o,setContainer:n,removeContainer:l}}]),angular.module("duScroll.smoothScroll",["duScroll.scrollHelpers","duScroll.scrollContainerAPI"]).directive("duSmoothScroll",["duScrollDuration","duScrollOffset","scrollContainerAPI",function(e,t,n){"use strict";return{link:function(r,o,l){o.on("click",function(o){if(l.href&&-1!==l.href.indexOf("#")){var i=document.getElementById(l.href.replace(/.*(?=#[^\s]+$)/,"").substring(1));if(i&&i.getBoundingClientRect){o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault();var u=l.offset?parseInt(l.offset,10):t,c=l.duration?parseInt(l.duration,10):e,a=n.getContainer(r);a.duScrollToElement(angular.element(i),isNaN(u)?0:u,isNaN(c)?0:c)}}})}}}]),angular.module("duScroll.spyContext",["duScroll.spyAPI"]).directive("duSpyContext",["spyAPI",function(e){"use strict";return{restrict:"A",scope:!0,compile:function(){return{pre:function(t){e.createContext(t)}}}}}]),angular.module("duScroll.scrollContainer",["duScroll.scrollContainerAPI"]).directive("duScrollContainer",["scrollContainerAPI",function(e){"use strict";return{restrict:"A",scope:!0,compile:function(){return{pre:function(t,n,r){r.$observe("duScrollContainer",function(r){angular.isString(r)&&(r=document.getElementById(r)),r=angular.isElement(r)?angular.element(r):n,e.setContainer(t,r),t.$on("$destroy",function(){e.removeContainer(t)})})}}}}}]),angular.module("duScroll.scrollspy",["duScroll.spyAPI"]).directive("duScrollspy",["spyAPI","duScrollOffset","$timeout","$rootScope",function(e,t,n,r){"use strict";var o=function(e,t,n){angular.isElement(e)?this.target=e:angular.isString(e)&&(this.targetId=e),this.$element=t,this.offset=n};return o.prototype.getTargetElement=function(){return!this.target&&this.targetId&&(this.target=document.getElementById(this.targetId)),this.target},o.prototype.getTargetPosition=function(){var e=this.getTargetElement();return e?e.getBoundingClientRect():void 0},o.prototype.flushTargetCache=function(){this.targetId&&(this.target=void 0)},{link:function(l,i,u){var c,a=u.ngHref||u.href;a&&-1!==a.indexOf("#")?c=a.replace(/.*(?=#[^\s]+$)/,"").substring(1):u.duScrollspy&&(c=u.duScrollspy),c&&n(function(){var n=new o(c,i,-(u.offset?parseInt(u.offset,10):t));e.addSpy(n),l.$on("$destroy",function(){e.removeSpy(n)}),l.$on("$locationChangeSuccess",n.flushTargetCache.bind(n)),r.$on("$stateChangeSuccess",n.flushTargetCache.bind(n))},0,!1)}}}]),angular.module("memry",["ngRoute","duScroll"]),angular.module("memry").config(["$routeProvider",function(e){"use strict";e.when("/",{templateUrl:"views/main.html"})}]),angular.module("memry").controller("DefinitionFormController",["$scope","defModel","scrollToDef",function(e,t,n){"use strict";e.hideDescription=!0,e.titleChange=function(){var r=t.findIDByTitleSubstr(e.title);n.byID(r),e.hideDescription=r||""===e.title},e.titleInputBegin=function(){n.resetID()},e.titleInputEnd=function(){n.resetID()},e.addDefinition=function(){e.title&&e.description&&(t.addDefinition(e.title,e.description),e.title="",e.description="",e.hideDescription=!0)}}]),angular.module("memry").controller("DefinitionListController",["$scope","defModel",function(e,t){"use strict";e.$watch(function(){return t.data.defs},function(n){"undefined"!=typeof n&&(e.definitions=t.data.defs)}),e.turnOnEditMode=function(t){e.definitions.forEach(function(e){e.editMode=!1}),e.definitions[t].editMode=!0},e.turnOffEditMode=function(t){e.definitions[t].editMode=!1},e.editDefinition=function(n,r){e.turnOffEditMode(n),t.editDefinition(r)},e.delDefinition=function(e){t.deleteDefinition(e)}}]),angular.module("memry").controller("MainController",function(){"use strict"}),angular.module("memry").factory("defModel",["$q","defServer",function(e,t){"use strict";function n(){t.getAll().then(function(e){r.data.defs=e.data})}var r={};return r.data={},r.getDefs=function(){var e=t.getAll();return e.then(function(e){r.data.defs=e.data}),e},r.addDefinition=function(e,n){t.create({title:e,description:n}).then(function(e){console.log(e.data),r.getDefs()})},r.editDefinition=function(e){t.update(e).then(function(e){console.log(e.data),r.getDefs()})},r.deleteDefinition=function(e){t.delete(e).then(function(e){console.log(e.data),r.getDefs()})},r.findIDByTitleSubstr=function(e){if("string"!=typeof e)throw new Error("findIDByTitleSubstr requires string input");var t=null;return r.data.defs.forEach(function(n){var r=n.title.indexOf(e);return 0===r?(t=n._id,!0):void 0}),t},n(),r}]),angular.module("memry").factory("defServer",["$http",function(e){"use strict";return{getAll:function(){return e.get("/api/defs")},getOne:function(t){return e.get("/api/defs/"+t)},create:function(t){return e.post("/api/defs",t)},update:function(t){return e.put("/api/defs/"+t._id,t)},"delete":function(t){return e.delete("/api/defs/"+t)}}}]),angular.module("memry").factory("scrollToDef",["$document","defModel",function(e,t){"use strict";var n={},r={};return r.currentScrollDefID=null,n.byID=function(t){if(r.currentScrollDefID!==t){r.currentScrollDefID=t;var n=angular.element(document.getElementById(t));e.scrollTo(n,0,1e3)}},n.byTitle=function(e){if("string"!=typeof e)throw new Error("scrollToDef.byTitle requires string input");if(""!==e){var r=t.findIDByTitleSubstr(e);r&&n.byID(r)}},n.resetID=function(){r.currentScrollDefID=null},n}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuZ3VsYXItc2Nyb2xsLmpzIiwibWVtcnkvbW9kdWxlLmpzIiwibWVtcnkvY29uZmlnL2NmZy1yb3V0ZXMuanMiLCJtZW1yeS9jb250cm9sbGVycy9jdHJsLWRlZl9mb3JtLmpzIiwibWVtcnkvY29udHJvbGxlcnMvY3RybC1kZWZfbGlzdC5qcyIsIm1lbXJ5L2NvbnRyb2xsZXJzL2N0cmwtbWFpbi5qcyIsIm1lbXJ5L3NlcnZpY2VzL3NydmMtZGVmX21vZGVsLmpzIiwibWVtcnkvc2VydmljZXMvc3J2Yy1kZWZfc2VydmVyLmpzIiwibWVtcnkvc2VydmljZXMvc3J2Yy1zY3JvbGxfdG9fZGVmLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLEdBQUEsdUJBQUEsU0FBQSxHQUNBLFlBRUEsT0FBQSxHQUFBLEVBQ0EsS0FBQSxJQUFBLEVBQUEsRUFBQSxHQUFBLEVBRUEsRUFBQSxLQUFBLElBQUEsR0FBQSxFQUFBLEdBQUEsR0FBQSxFQUdBLFNBQUEsT0FBQSxZQUNBLHFCQUNBLHdCQUNBLDJCQUNBLHNCQUNBLDJCQUdBLE1BQUEsbUJBQUEsS0FFQSxNQUFBLGtCQUFBLEtBRUEsTUFBQSxrQkFBQSxHQUVBLE1BQUEsaUJBQUEsR0FFQSxNQUFBLGlCQUFBLHVCQUdBLFFBQUEsT0FBQSwwQkFBQSw4QkFDQSxLQUFBLFVBQUEsS0FBQSxrQkFBQSxtQkFBQSxpQkFBQSxtQkFBQSxpQkFBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQ0EsWUFFQSxJQUFBLE1BRUEsRUFBQSxTQUFBLEdBQ0EsTUFBQSxtQkFBQSxlQUFBLFlBQUEsZUFBQSxFQUFBLFVBQUEsRUFBQSxXQUFBLEVBQUEsZUFHQSxFQUFBLFNBQUEsR0FDQSxNQUFBLG1CQUFBLGNBQUEsWUFBQSxjQUFBLEVBQUEsVUFBQSxFQUFBLFdBQUEsRUFBQSxjQUdBLEVBQUEsU0FBQSxHQUNBLE1BQUEsR0FBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsR0FHQSxHQUFBLFdBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxHQUFBLEVBTUEsSUFMQSxRQUFBLFVBQUEsR0FDQSxFQUFBLEtBQUEsa0JBQ0EsSUFDQSxFQUFBLEtBQUEsb0JBRUEsRUFDQSxNQUFBLEdBQUEsTUFBQSxLQUFBLFVBRUEsSUFBQSxHQUFBLEVBQUEsS0FDQSxPQUFBLEdBQUEsR0FDQSxFQUFBLFNBQUEsRUFBQSxJQUVBLEVBQUEsV0FBQSxPQUNBLEVBQUEsVUFBQSxJQUdBLElBQUEsR0FBQSxDQUNBLEdBQUEsbUJBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxHQUNBLElBQUEsSUFDQSxFQUFBLEVBRUEsSUFBQSxHQUFBLEtBQUEsZUFDQSxFQUFBLEtBQUEsY0FDQSxFQUFBLEtBQUEsTUFBQSxFQUFBLEdBQ0EsRUFBQSxLQUFBLE1BQUEsRUFBQSxHQUVBLEVBQUEsS0FDQSxFQUFBLEtBRUEsRUFBQSxnREFDQSxFQUFBLFNBQUEsS0FDQSxHQUFBLEVBQUEsTUFBQSxLQUNBLEVBQUEsT0FBQSxFQUFBLEdBQ0EsRUFBQSxHQUNBLEVBQUEsU0FDQSxFQUFBLE1BU0EsSUFMQSxHQUNBLElBRUEsRUFBQSxFQUFBLFNBRUEsSUFBQSxFQUVBLE1BREEsR0FBQSxVQUNBLEVBQUEsT0FHQSxJQUFBLEdBQUEsU0FBQSxHQUNBLE9BQUEsSUFDQSxFQUFBLEVBR0EsSUFBQSxHQUFBLEVBQUEsRUFDQSxFQUFBLEdBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxFQUVBLEdBQUEsU0FDQSxFQUFBLEtBQUEsS0FBQSxFQUFBLEdBQ0EsRUFBQSxLQUFBLEtBQUEsRUFBQSxJQUVBLEVBQUEsRUFDQSxFQUFBLEVBQUEsSUFFQSxFQUFBLE9BQUEsRUFBQSxHQUNBLEVBQUEsS0FDQSxFQUFBLFdBVUEsT0FMQSxHQUFBLFdBQUEsRUFBQSxHQUVBLEVBQUEsS0FBQSxFQUFBLEdBRUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxTQUdBLEVBQUEsa0JBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLFFBQ0EsUUFBQSxTQUFBLElBQUEsTUFBQSxNQUNBLEVBQUEsRUFFQSxJQUFBLEdBQUEsS0FBQSxjQUFBLEVBQUEsR0FBQSx3QkFBQSxJQUFBLENBSUEsT0FIQSxHQUFBLEtBQ0EsR0FBQSxFQUFBLHdCQUFBLEtBRUEsS0FBQSxXQUFBLEVBQUEsRUFBQSxFQUFBLElBR0EsRUFBQSxhQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsR0FBQSxRQUFBLFNBQUEsR0FDQSxNQUFBLE1BQUEsV0FBQSxFQUFBLEtBQUEsY0FBQSxFQUFBLEVBRUEsSUFBQSxHQUFBLEVBQUEsS0FDQSxPQUFBLEdBQUEsR0FDQSxFQUFBLFNBQUEsU0FBQSxnQkFBQSxZQUFBLFNBQUEsS0FBQSxXQUVBLEVBQUEsWUFFQSxFQUFBLFlBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxHQUFBLFFBQUEsU0FBQSxHQUNBLE1BQUEsTUFBQSxXQUFBLEtBQUEsZUFBQSxFQUFBLEVBQUEsRUFFQSxJQUFBLEdBQUEsRUFBQSxLQUNBLE9BQUEsR0FBQSxHQUNBLEVBQUEsU0FBQSxTQUFBLGdCQUFBLFdBQUEsU0FBQSxLQUFBLFVBRUEsRUFBQSxXQUdBLEVBQUEsMEJBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxHQUNBLE1BQUEsTUFBQSxrQkFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLElBR0EsRUFBQSxvQkFBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLE1BQUEsTUFBQSxZQUFBLEVBQUEsR0FBQSxFQUFBLElBR0EsRUFBQSxxQkFBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLE1BQUEsTUFBQSxhQUFBLEVBQUEsR0FBQSxFQUFBLElBR0EsUUFBQSxRQUFBLEVBQUEsU0FBQSxFQUFBLEdBQ0EsUUFBQSxRQUFBLFVBQUEsR0FBQSxDQUdBLElBQUEsR0FBQSxFQUFBLFFBQUEsWUFBQSxTQUNBLFNBQUEsWUFBQSxRQUFBLFFBQUEsVUFBQSxNQUNBLFFBQUEsUUFBQSxVQUFBLEdBQUEsUUFRQSxRQUFBLE9BQUEsd0JBQ0EsUUFBQSxZQUFBLFVBQUEsU0FBQSxHQUNBLFlBRUEsSUFBQSxJQUFBLFNBQUEsTUFBQSxJQUFBLEtBRUEsT0FBQSxVQUFBLEVBQUEsR0FDQSxHQUFBLEVBQUEsR0FDQSxNQUFBLEdBQUEsRUFHQSxLQUFBLEdBQUEsR0FEQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEdBQUEsY0FBQSxFQUFBLE9BQUEsR0FDQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsSUFFQSxHQURBLEVBQUEsRUFBQSxHQUFBLEVBQ0EsRUFBQSxHQUNBLE1BQUEsR0FBQSxFQUdBLE9BQUEsT0FJQSxRQUFBLE9BQUEsNkJBQUEsc0JBQ0EsUUFBQSxvQkFBQSxXQUFBLFdBQUEsU0FBQSxFQUFBLEdBQ0EsWUFFQSxJQUFBLEdBQUEsRUFDQSxFQUFBLFNBQUEsR0FDQSxHQUFBLElBQUEsR0FBQSxPQUFBLFVBQ0EsRUFBQSxLQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsSUFDQSxFQUFBLEVBQUEsV0FBQSxFQUFBLEVBQUEsSUFDQSxFQUVBLE9BREEsR0FBQSxFQUFBLEVBQ0EsRUFHQSxPQUFBLEdBQUEsd0JBQUEsTUFFQSxRQUFBLG1CQUFBLFdBQUEsV0FBQSxTQUFBLEVBQUEsR0FDQSxZQUVBLElBQUEsR0FBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLEdBR0EsT0FBQSxHQUFBLHVCQUFBLE1BSUEsUUFBQSxPQUFBLG1CQUFBLGdDQUNBLFFBQUEsVUFBQSxhQUFBLFdBQUEscUJBQUEsaUJBQUEsa0JBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEdBQ0EsWUFFQSxJQUFBLEdBQUEsU0FBQSxHQUNBLEdBQUEsSUFBQSxFQUFBLEdBQUEsRUFDQSxFQUFBLFdBQ0EsR0FBQSxDQUNBLElBQUEsR0FBQSxFQUFBLFVBQ0EsRUFBQSxFQUFBLEdBQ0EsRUFBQSxHQUVBLG1CQUFBLGNBQUEsWUFBQSxjQUFBLEVBQUEsVUFBQSxFQUFBLFdBQUEsRUFBQSxnQkFDQSxFQUFBLEVBQUEsd0JBQUEsSUFHQSxJQUFBLEdBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxDQUtBLEtBSkEsRUFBQSxFQUFBLE1BQ0EsRUFBQSxFQUFBLGdCQUNBLEVBQUEsT0FFQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsSUFDQSxFQUFBLEVBQUEsR0FDQSxFQUFBLEVBQUEsb0JBQ0EsR0FFQSxFQUFBLElBQUEsRUFBQSxPQUFBLEVBQUEsSUFBQSxHQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsVUFDQSxHQUFBLEVBQUEsSUFBQSxFQUFBLE9BQ0EsR0FDQSxJQUFBLEVBQUEsSUFDQSxJQUFBLEdBS0EsS0FDQSxFQUFBLEVBQUEsS0FFQSxJQUFBLEdBQUEsSUFBQSxJQUNBLElBQ0EsRUFBQSxTQUFBLFlBQUEsVUFDQSxFQUFBLFdBQUEsNkJBQUEsRUFBQSxXQUVBLElBQ0EsRUFBQSxTQUFBLFNBQUEsVUFDQSxFQUFBLFdBQUEsMkJBQUEsRUFBQSxXQUVBLEVBQUEsZ0JBQUEsR0FHQSxPQUFBLEdBS0EsV0FDQSxFQVNBLEdBQUEsR0FSQSxJQUNBLEVBQUEsRUFBQSxXQUNBLEdBQUEsRUFDQSxHQUNBLEtBRUEsR0FBQSxLQVpBLEdBbUJBLEtBRUEsRUFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsSUFDQSxHQUNBLFNBVUEsT0FQQSxHQUFBLFFBQUEsRUFBQSxHQUNBLEVBQUEsR0FBQSxFQUVBLEVBQUEsSUFBQSxXQUFBLFdBQ0EsRUFBQSxLQUdBLEdBR0EsRUFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsSUFDQSxFQUFBLEVBQUEsR0FBQSxFQUFBLEVBQUEsU0FDQSxJQUNBLEVBQUEsSUFBQSxTQUFBLEVBQUEsZUFFQSxHQUFBLElBR0EsRUFBQSxFQUFBLEdBRUEsRUFBQSxTQUFBLEdBQ0EsTUFBQSxHQUFBLEVBQUEsS0FDQSxFQUFBLEVBQUEsS0FFQSxFQUFBLFFBQ0EsRUFBQSxFQUFBLFNBRUEsRUFBQSxJQUdBLEVBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLEVBQUEsRUFBQSxTQUFBLE9BQ0EsSUFBQSxFQUNBLE1BQUEsR0FBQSxFQUdBLEtBQUEsSUFBQSxHQUVBLEdBREEsRUFBQSxFQUFBLEdBQ0EsS0FBQSxFQUFBLE1BQUEsUUFBQSxHQUNBLE1BQUEsSUFLQSxFQUFBLFNBQUEsR0FDQSxLQUFBLEVBQUEsWUFFQSxHQURBLEVBQUEsRUFBQSxXQUNBLElBQUEsU0FDQSxPQUFBLENBR0EsUUFBQSxHQUdBLEVBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLEVBQ0EsS0FDQSxFQUFBLE1BQUEsS0FBQSxHQUNBLEVBQUEsV0FBQSxFQUFBLEVBQUEsYUFDQSxFQUFBLFdBQ0EsRUFBQSxVQUFBLElBQUEsU0FBQSxFQUFBLFNBRUEsRUFBQSxVQUFBLEVBQUEsYUFBQSxFQUFBLFNBQUEsU0FDQSxFQUFBLFVBQUEsR0FBQSxTQUFBLEVBQUEsU0FBQSxlQUFBLGFBSUEsRUFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsRUFDQSxLQUFBLEVBQUEsa0JBQ0EsRUFBQSxnQkFBQSxLQUVBLElBQUEsR0FBQSxFQUFBLE1BQUEsUUFBQSxFQUNBLE1BQUEsR0FDQSxFQUFBLE1BQUEsT0FBQSxFQUFBLEdBRUEsRUFBQSxTQUFBLEtBR0EsUUFDQSxPQUFBLEVBQ0EsVUFBQSxFQUNBLGNBQUEsRUFDQSxlQUFBLEVBQ0EsbUJBQUEsTUFLQSxRQUFBLE9BQUEsa0NBQ0EsUUFBQSxzQkFBQSxZQUFBLFNBQUEsR0FDQSxZQUVBLElBQUEsTUFFQSxFQUFBLFNBQUEsRUFBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLEdBRUEsT0FEQSxHQUFBLEdBQUEsRUFDQSxHQUdBLEVBQUEsU0FBQSxHQUNBLE1BQUEsR0FBQSxFQUFBLEtBQ0EsRUFBQSxJQUVBLEVBQUEsUUFDQSxFQUFBLEVBQUEsU0FEQSxRQU1BLEVBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLEVBQ0EsT0FBQSxHQUFBLEVBQUEsR0FBQSxHQUdBLEVBQUEsU0FBQSxHQUNBLEdBQUEsR0FBQSxFQUFBLEVBQ0EsVUFDQSxHQUFBLEdBSUEsUUFDQSxlQUFBLEVBQ0EsYUFBQSxFQUNBLGFBQUEsRUFDQSxnQkFBQSxNQUtBLFFBQUEsT0FBQSx5QkFBQSx5QkFBQSxnQ0FDQSxVQUFBLGtCQUFBLG1CQUFBLGlCQUFBLHFCQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsWUFFQSxRQUNBLEtBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLEdBQUEsUUFBQSxTQUFBLEdBQ0EsR0FBQSxFQUFBLE1BQUEsS0FBQSxFQUFBLEtBQUEsUUFBQSxLQUFBLENBRUEsR0FBQSxHQUFBLFNBQUEsZUFBQSxFQUFBLEtBQUEsUUFBQSxpQkFBQSxJQUFBLFVBQUEsR0FDQSxJQUFBLEdBQUEsRUFBQSxzQkFBQSxDQUVBLEVBQUEsaUJBQUEsRUFBQSxrQkFDQSxFQUFBLGdCQUFBLEVBQUEsZ0JBRUEsSUFBQSxHQUFBLEVBQUEsT0FBQSxTQUFBLEVBQUEsT0FBQSxJQUFBLEVBQ0EsRUFBQSxFQUFBLFNBQUEsU0FBQSxFQUFBLFNBQUEsSUFBQSxFQUNBLEVBQUEsRUFBQSxhQUFBLEVBRUEsR0FBQSxrQkFDQSxRQUFBLFFBQUEsR0FDQSxNQUFBLEdBQUEsRUFBQSxFQUNBLE1BQUEsR0FBQSxFQUFBLFlBUUEsUUFBQSxPQUFBLHVCQUFBLG9CQUNBLFVBQUEsZ0JBQUEsU0FBQSxTQUFBLEdBQ0EsWUFFQSxRQUNBLFNBQUEsSUFDQSxPQUFBLEVBQ0EsUUFBQSxXQUNBLE9BQ0EsSUFBQSxTQUFBLEdBQ0EsRUFBQSxjQUFBLFVBUUEsUUFBQSxPQUFBLDRCQUFBLGdDQUNBLFVBQUEscUJBQUEscUJBQUEsU0FBQSxHQUNBLFlBRUEsUUFDQSxTQUFBLElBQ0EsT0FBQSxFQUNBLFFBQUEsV0FDQSxPQUNBLElBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxFQUFBLFNBQUEsb0JBQUEsU0FBQSxHQUNBLFFBQUEsU0FBQSxLQUNBLEVBQUEsU0FBQSxlQUFBLElBR0EsRUFBQSxRQUFBLFVBQUEsR0FBQSxRQUFBLFFBQUEsR0FBQSxFQUNBLEVBQUEsYUFBQSxFQUFBLEdBQ0EsRUFBQSxJQUFBLFdBQUEsV0FDQSxFQUFBLGdCQUFBLGNBVUEsUUFBQSxPQUFBLHNCQUFBLG9CQUNBLFVBQUEsZUFBQSxTQUFBLGlCQUFBLFdBQUEsYUFBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEdBQ0EsWUFFQSxJQUFBLEdBQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxRQUFBLFVBQUEsR0FDQSxLQUFBLE9BQUEsRUFDQSxRQUFBLFNBQUEsS0FDQSxLQUFBLFNBQUEsR0FFQSxLQUFBLFNBQUEsRUFDQSxLQUFBLE9BQUEsRUF1QkEsT0FwQkEsR0FBQSxVQUFBLGlCQUFBLFdBSUEsT0FIQSxLQUFBLFFBQUEsS0FBQSxXQUNBLEtBQUEsT0FBQSxTQUFBLGVBQUEsS0FBQSxXQUVBLEtBQUEsUUFHQSxFQUFBLFVBQUEsa0JBQUEsV0FDQSxHQUFBLEdBQUEsS0FBQSxrQkFDQSxPQUFBLEdBQ0EsRUFBQSx3QkFEQSxRQUtBLEVBQUEsVUFBQSxpQkFBQSxXQUNBLEtBQUEsV0FDQSxLQUFBLE9BQUEsVUFLQSxLQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsR0FDQSxHQURBLEVBQUEsRUFBQSxRQUFBLEVBQUEsSUFHQSxJQUFBLEtBQUEsRUFBQSxRQUFBLEtBQ0EsRUFBQSxFQUFBLFFBQUEsaUJBQUEsSUFBQSxVQUFBLEdBQ0EsRUFBQSxjQUNBLEVBQUEsRUFBQSxhQUVBLEdBSUEsRUFBQSxXQUNBLEdBQUEsR0FBQSxHQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsT0FBQSxTQUFBLEVBQUEsT0FBQSxJQUFBLEdBQ0EsR0FBQSxPQUFBLEdBRUEsRUFBQSxJQUFBLFdBQUEsV0FDQSxFQUFBLFVBQUEsS0FFQSxFQUFBLElBQUEseUJBQUEsRUFBQSxpQkFBQSxLQUFBLElBQ0EsRUFBQSxJQUFBLHNCQUFBLEVBQUEsaUJBQUEsS0FBQSxLQUNBLEdBQUEsUUNsa0JBLFFBQUEsT0FBQSxTQUFBLFVBQUEsYUNEQSxRQUFBLE9BQUEsU0FDQSxRQUFBLGlCQUFBLFNBQUEsR0FDQSxZQUNBLEdBQ0EsS0FBQSxLQUNBLFlBQUEsdUJDTEEsUUFBQSxPQUFBLFNBQ0EsV0FBQSw0QkFBQSxTQUFBLFdBQUEsY0FBQSxTQUFBLEVBQUEsRUFBQSxHQUNBLFlBQ0EsR0FBQSxpQkFBQSxFQUNBLEVBQUEsWUFBQSxXQUNBLEdBQUEsR0FBQSxFQUFBLG9CQUFBLEVBQUEsTUFDQSxHQUFBLEtBQUEsR0FDQSxFQUFBLGdCQUFBLEdBQUEsS0FBQSxFQUFBLE9BR0EsRUFBQSxnQkFBQSxXQUNBLEVBQUEsV0FHQSxFQUFBLGNBQUEsV0FDQSxFQUFBLFdBR0EsRUFBQSxjQUFBLFdBQ0EsRUFBQSxPQUFBLEVBQUEsY0FDQSxFQUFBLGNBQUEsRUFBQSxNQUFBLEVBQUEsYUFHQSxFQUFBLE1BQUEsR0FDQSxFQUFBLFlBQUEsR0FDQSxFQUFBLGlCQUFBLE9DekJBLFFBQUEsT0FBQSxTQUNBLFdBQUEsNEJBQUEsU0FBQSxXQUFBLFNBQUEsRUFBQSxHQUNBLFlBR0EsR0FBQSxPQUFBLFdBQUEsTUFBQSxHQUFBLEtBQUEsTUFBQSxTQUFBLEdBQ0EsbUJBQUEsS0FDQSxFQUFBLFlBQUEsRUFBQSxLQUFBLFFBSUEsRUFBQSxlQUFBLFNBQUEsR0FDQSxFQUFBLFlBQUEsUUFBQSxTQUFBLEdBQ0EsRUFBQSxVQUFBLElBRUEsRUFBQSxZQUFBLEdBQUEsVUFBQSxHQUdBLEVBQUEsZ0JBQUEsU0FBQSxHQUNBLEVBQUEsWUFBQSxHQUFBLFVBQUEsR0FJQSxFQUFBLGVBQUEsU0FBQSxFQUFBLEdBQ0EsRUFBQSxnQkFBQSxHQUdBLEVBQUEsZUFBQSxJQUdBLEVBQUEsY0FBQSxTQUFBLEdBQ0EsRUFBQSxpQkFBQSxPQy9CQSxRQUFBLE9BQUEsU0FDQSxXQUFBLGlCQUFBLFdBQ0EsZUNGQSxRQUFBLE9BQUEsU0FDQSxRQUFBLFlBQUEsS0FBQSxZQUFBLFNBQUEsRUFBQSxHQUNBLFlBU0EsU0FBQSxLQUNBLEVBQUEsU0FDQSxLQUFBLFNBQUEsR0FDQSxFQUFBLEtBQUEsS0FBQSxFQUFBLE9BVkEsR0FBQSxLQXVGQSxPQXJGQSxHQUFBLFFBWUEsRUFBQSxRQUFBLFdBRUEsR0FBQSxHQUFBLEVBQUEsUUFJQSxPQUhBLEdBQUEsS0FBQSxTQUFBLEdBQ0EsRUFBQSxLQUFBLEtBQUEsRUFBQSxPQUVBLEdBTUEsRUFBQSxjQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsUUFDQSxNQUFBLEVBQ0EsWUFBQSxJQUVBLEtBQUEsU0FBQSxHQUNBLFFBQUEsSUFBQSxFQUFBLE1BQ0EsRUFBQSxhQU9BLEVBQUEsZUFBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLEdBQ0EsS0FBQSxTQUFBLEdBRUEsUUFBQSxJQUFBLEVBQUEsTUFDQSxFQUFBLGFBT0EsRUFBQSxpQkFBQSxTQUFBLEdBQ0EsRUFBQSxPQUFBLEdBQ0EsS0FBQSxTQUFBLEdBRUEsUUFBQSxJQUFBLEVBQUEsTUFDQSxFQUFBLGFBU0EsRUFBQSxvQkFBQSxTQUFBLEdBRUEsR0FBQSxnQkFBQSxHQUNBLEtBQUEsSUFBQSxPQUFBLDRDQUVBLElBQUEsR0FBQSxJQVdBLE9BVkEsR0FBQSxLQUFBLEtBQUEsUUFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEVBQUEsTUFBQSxRQUFBLEVBRUEsT0FBQSxLQUFBLEdBQ0EsRUFBQSxFQUFBLEtBRUEsR0FIQSxTQU9BLEdBR0EsSUFFQSxLQzNGQSxRQUFBLE9BQUEsU0FDQSxRQUFBLGFBQUEsUUFBQSxTQUFBLEdBQ0EsWUFDQSxRQUNBLE9BQUEsV0FDQSxNQUFBLEdBQUEsSUFBQSxjQUdBLE9BQUEsU0FBQSxHQUNBLE1BQUEsR0FBQSxJQUFBLGFBQUEsSUFHQSxPQUFBLFNBQUEsR0FDQSxNQUFBLEdBQUEsS0FBQSxZQUFBLElBR0EsT0FBQSxTQUFBLEdBQ0EsTUFBQSxHQUFBLElBQUEsYUFBQSxFQUFBLElBQUEsSUFHQSxTQUFBLFNBQUEsR0FDQSxNQUFBLEdBQUEsT0FBQSxhQUFBLFFDckJBLFFBQUEsT0FBQSxTQUNBLFFBQUEsZUFBQSxZQUFBLFdBQUEsU0FBQSxFQUFBLEdBQ0EsWUFFQSxJQUFBLE1BRUEsSUE4QkEsT0E1QkEsR0FBQSxtQkFBQSxLQUVBLEVBQUEsS0FBQSxTQUFBLEdBQ0EsR0FBQSxFQUFBLHFCQUFBLEVBQUEsQ0FDQSxFQUFBLG1CQUFBLENBQ0EsSUFBQSxHQUFBLFFBQUEsUUFBQSxTQUFBLGVBQUEsR0FDQSxHQUFBLFNBQUEsRUFBQSxFQUFBLE9BSUEsRUFBQSxRQUFBLFNBQUEsR0FFQSxHQUFBLGdCQUFBLEdBQ0EsS0FBQSxJQUFBLE9BQUEsNENBR0EsSUFBQSxLQUFBLEVBQUEsQ0FDQSxHQUFBLEdBQUEsRUFBQSxvQkFBQSxFQUNBLElBQ0EsRUFBQSxLQUFBLEtBS0EsRUFBQSxRQUFBLFdBQ0EsRUFBQSxtQkFBQSxNQUdBIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICAqIHggaXMgYSB2YWx1ZSBiZXR3ZWVuIDAgYW5kIDEsIGluZGljYXRpbmcgd2hlcmUgaW4gdGhlIGFuaW1hdGlvbiB5b3UgYXJlLlxuICAqL1xudmFyIGR1U2Nyb2xsRGVmYXVsdEVhc2luZyA9IGZ1bmN0aW9uICh4KSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBpZih4IDwgMC41KSB7XG4gICAgcmV0dXJuIE1hdGgucG93KHgqMiwgMikvMjtcbiAgfVxuICByZXR1cm4gMS1NYXRoLnBvdygoMS14KSoyLCAyKS8yO1xufTtcblxuYW5ndWxhci5tb2R1bGUoJ2R1U2Nyb2xsJywgW1xuICAnZHVTY3JvbGwuc2Nyb2xsc3B5JywgXG4gICdkdVNjcm9sbC5zbW9vdGhTY3JvbGwnLCBcbiAgJ2R1U2Nyb2xsLnNjcm9sbENvbnRhaW5lcicsIFxuICAnZHVTY3JvbGwuc3B5Q29udGV4dCcsXG4gICdkdVNjcm9sbC5zY3JvbGxIZWxwZXJzJ1xuXSlcbiAgLy9EZWZhdWx0IGFuaW1hdGlvbiBkdXJhdGlvbiBmb3Igc21vb3RoU2Nyb2xsIGRpcmVjdGl2ZVxuICAudmFsdWUoJ2R1U2Nyb2xsRHVyYXRpb24nLCAzNTApXG4gIC8vU2Nyb2xsc3B5IGRlYm91bmNlIGludGVydmFsLCBzZXQgdG8gMCB0byBkaXNhYmxlXG4gIC52YWx1ZSgnZHVTY3JvbGxTcHlXYWl0JywgMTAwKVxuICAvL1dldGhlciBvciBub3QgbXVsdGlwbGUgc2Nyb2xsc3BpZXMgY2FuIGJlIGFjdGl2ZSBhdCBvbmNlIFxuICAudmFsdWUoJ2R1U2Nyb2xsR3JlZWR5JywgZmFsc2UpXG4gIC8vRGVmYXVsdCBvZmZzZXQgZm9yIHNtb290aFNjcm9sbCBkaXJlY3RpdmVcbiAgLnZhbHVlKCdkdVNjcm9sbE9mZnNldCcsIDApXG4gIC8vRGVmYXVsdCBlYXNpbmcgZnVuY3Rpb24gZm9yIHNjcm9sbCBhbmltYXRpb25cbiAgLnZhbHVlKCdkdVNjcm9sbEVhc2luZycsIGR1U2Nyb2xsRGVmYXVsdEVhc2luZyk7XG5cblxuYW5ndWxhci5tb2R1bGUoJ2R1U2Nyb2xsLnNjcm9sbEhlbHBlcnMnLCBbJ2R1U2Nyb2xsLnJlcXVlc3RBbmltYXRpb24nXSlcbi5ydW4oW1wiJHdpbmRvd1wiLCBcIiRxXCIsIFwiY2FuY2VsQW5pbWF0aW9uXCIsIFwicmVxdWVzdEFuaW1hdGlvblwiLCBcImR1U2Nyb2xsRWFzaW5nXCIsIFwiZHVTY3JvbGxEdXJhdGlvblwiLCBcImR1U2Nyb2xsT2Zmc2V0XCIsIGZ1bmN0aW9uKCR3aW5kb3csICRxLCBjYW5jZWxBbmltYXRpb24sIHJlcXVlc3RBbmltYXRpb24sIGR1U2Nyb2xsRWFzaW5nLCBkdVNjcm9sbER1cmF0aW9uLCBkdVNjcm9sbE9mZnNldCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIHByb3RvID0ge307XG5cbiAgdmFyIGlzRG9jdW1lbnQgPSBmdW5jdGlvbihlbCkge1xuICAgIHJldHVybiAodHlwZW9mIEhUTUxEb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgZWwgaW5zdGFuY2VvZiBIVE1MRG9jdW1lbnQpIHx8IChlbC5ub2RlVHlwZSAmJiBlbC5ub2RlVHlwZSA9PT0gZWwuRE9DVU1FTlRfTk9ERSk7XG4gIH07XG5cbiAgdmFyIGlzRWxlbWVudCA9IGZ1bmN0aW9uKGVsKSB7XG4gICAgcmV0dXJuICh0eXBlb2YgSFRNTEVsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGVsIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHx8IChlbC5ub2RlVHlwZSAmJiBlbC5ub2RlVHlwZSA9PT0gZWwuRUxFTUVOVF9OT0RFKTtcbiAgfTtcblxuICB2YXIgdW53cmFwID0gZnVuY3Rpb24oZWwpIHtcbiAgICByZXR1cm4gaXNFbGVtZW50KGVsKSB8fCBpc0RvY3VtZW50KGVsKSA/IGVsIDogZWxbMF07XG4gIH07XG5cbiAgcHJvdG8uZHVTY3JvbGxUbyA9IGZ1bmN0aW9uKGxlZnQsIHRvcCwgZHVyYXRpb24sIGVhc2luZykge1xuICAgIHZhciBhbGlhc0ZuO1xuICAgIGlmKGFuZ3VsYXIuaXNFbGVtZW50KGxlZnQpKSB7XG4gICAgICBhbGlhc0ZuID0gdGhpcy5kdVNjcm9sbFRvRWxlbWVudDtcbiAgICB9IGVsc2UgaWYoZHVyYXRpb24pIHtcbiAgICAgIGFsaWFzRm4gPSB0aGlzLmR1U2Nyb2xsVG9BbmltYXRlZDtcbiAgICB9XG4gICAgaWYoYWxpYXNGbikge1xuICAgICAgcmV0dXJuIGFsaWFzRm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG4gICAgdmFyIGVsID0gdW53cmFwKHRoaXMpO1xuICAgIGlmKGlzRG9jdW1lbnQoZWwpKSB7XG4gICAgICByZXR1cm4gJHdpbmRvdy5zY3JvbGxUbyhsZWZ0LCB0b3ApO1xuICAgIH1cbiAgICBlbC5zY3JvbGxMZWZ0ID0gbGVmdDtcbiAgICBlbC5zY3JvbGxUb3AgPSB0b3A7XG4gIH07XG5cbiAgdmFyIHNjcm9sbEFuaW1hdGlvbiwgZGVmZXJyZWQ7XG4gIHByb3RvLmR1U2Nyb2xsVG9BbmltYXRlZCA9IGZ1bmN0aW9uKGxlZnQsIHRvcCwgZHVyYXRpb24sIGVhc2luZykge1xuICAgIGlmKGR1cmF0aW9uICYmICFlYXNpbmcpIHtcbiAgICAgIGVhc2luZyA9IGR1U2Nyb2xsRWFzaW5nO1xuICAgIH1cbiAgICB2YXIgc3RhcnRMZWZ0ID0gdGhpcy5kdVNjcm9sbExlZnQoKSxcbiAgICAgICAgc3RhcnRUb3AgPSB0aGlzLmR1U2Nyb2xsVG9wKCksXG4gICAgICAgIGRlbHRhTGVmdCA9IE1hdGgucm91bmQobGVmdCAtIHN0YXJ0TGVmdCksXG4gICAgICAgIGRlbHRhVG9wID0gTWF0aC5yb3VuZCh0b3AgLSBzdGFydFRvcCk7XG5cbiAgICB2YXIgc3RhcnRUaW1lID0gbnVsbDtcbiAgICB2YXIgZWwgPSB0aGlzO1xuXG4gICAgdmFyIGNhbmNlbE9uRXZlbnRzID0gJ3Njcm9sbCBtb3VzZWRvd24gbW91c2V3aGVlbCB0b3VjaG1vdmUga2V5ZG93bic7XG4gICAgdmFyIGNhbmNlbFNjcm9sbEFuaW1hdGlvbiA9IGZ1bmN0aW9uKCRldmVudCkge1xuICAgICAgaWYgKCEkZXZlbnQgfHwgJGV2ZW50LndoaWNoID4gMCkge1xuICAgICAgICBlbC51bmJpbmQoY2FuY2VsT25FdmVudHMsIGNhbmNlbFNjcm9sbEFuaW1hdGlvbik7XG4gICAgICAgIGNhbmNlbEFuaW1hdGlvbihzY3JvbGxBbmltYXRpb24pO1xuICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcbiAgICAgICAgc2Nyb2xsQW5pbWF0aW9uID0gbnVsbDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYoc2Nyb2xsQW5pbWF0aW9uKSB7XG4gICAgICBjYW5jZWxTY3JvbGxBbmltYXRpb24oKTtcbiAgICB9XG4gICAgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgaWYoIWRlbHRhTGVmdCAmJiAhZGVsdGFUb3ApIHtcbiAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIHZhciBhbmltYXRpb25TdGVwID0gZnVuY3Rpb24odGltZXN0YW1wKSB7XG4gICAgICBpZiAoc3RhcnRUaW1lID09PSBudWxsKSB7XG4gICAgICAgIHN0YXJ0VGltZSA9IHRpbWVzdGFtcDtcbiAgICAgIH1cblxuICAgICAgdmFyIHByb2dyZXNzID0gdGltZXN0YW1wIC0gc3RhcnRUaW1lO1xuICAgICAgdmFyIHBlcmNlbnQgPSAocHJvZ3Jlc3MgPj0gZHVyYXRpb24gPyAxIDogZWFzaW5nKHByb2dyZXNzL2R1cmF0aW9uKSk7XG5cbiAgICAgIGVsLnNjcm9sbFRvKFxuICAgICAgICBzdGFydExlZnQgKyBNYXRoLmNlaWwoZGVsdGFMZWZ0ICogcGVyY2VudCksXG4gICAgICAgIHN0YXJ0VG9wICsgTWF0aC5jZWlsKGRlbHRhVG9wICogcGVyY2VudClcbiAgICAgICk7XG4gICAgICBpZihwZXJjZW50IDwgMSkge1xuICAgICAgICBzY3JvbGxBbmltYXRpb24gPSByZXF1ZXN0QW5pbWF0aW9uKGFuaW1hdGlvblN0ZXApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZWwudW5iaW5kKGNhbmNlbE9uRXZlbnRzLCBjYW5jZWxTY3JvbGxBbmltYXRpb24pO1xuICAgICAgICBzY3JvbGxBbmltYXRpb24gPSBudWxsO1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vRml4IHJhbmRvbSBtb2JpbGUgc2FmYXJpIGJ1ZyB3aGVuIHNjcm9sbGluZyB0byB0b3AgYnkgaGl0dGluZyBzdGF0dXMgYmFyXG4gICAgZWwuZHVTY3JvbGxUbyhzdGFydExlZnQsIHN0YXJ0VG9wKTtcblxuICAgIGVsLmJpbmQoY2FuY2VsT25FdmVudHMsIGNhbmNlbFNjcm9sbEFuaW1hdGlvbik7XG5cbiAgICBzY3JvbGxBbmltYXRpb24gPSByZXF1ZXN0QW5pbWF0aW9uKGFuaW1hdGlvblN0ZXApO1xuICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICB9O1xuXG4gIHByb3RvLmR1U2Nyb2xsVG9FbGVtZW50ID0gZnVuY3Rpb24odGFyZ2V0LCBvZmZzZXQsIGR1cmF0aW9uLCBlYXNpbmcpIHtcbiAgICB2YXIgZWwgPSB1bndyYXAodGhpcyk7XG4gICAgaWYoIWFuZ3VsYXIuaXNOdW1iZXIob2Zmc2V0KSB8fCBpc05hTihvZmZzZXQpKSB7XG4gICAgICBvZmZzZXQgPSBkdVNjcm9sbE9mZnNldDtcbiAgICB9XG4gICAgdmFyIHRvcCA9IHRoaXMuZHVTY3JvbGxUb3AoKSArIHVud3JhcCh0YXJnZXQpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCAtIG9mZnNldDtcbiAgICBpZihpc0VsZW1lbnQoZWwpKSB7XG4gICAgICB0b3AgLT0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5kdVNjcm9sbFRvKDAsIHRvcCwgZHVyYXRpb24sIGVhc2luZyk7XG4gIH07XG5cbiAgcHJvdG8uZHVTY3JvbGxMZWZ0ID0gZnVuY3Rpb24odmFsdWUsIGR1cmF0aW9uLCBlYXNpbmcpIHtcbiAgICBpZihhbmd1bGFyLmlzTnVtYmVyKHZhbHVlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZHVTY3JvbGxUbyh2YWx1ZSwgdGhpcy5kdVNjcm9sbFRvcCgpLCBkdXJhdGlvbiwgZWFzaW5nKTtcbiAgICB9XG4gICAgdmFyIGVsID0gdW53cmFwKHRoaXMpO1xuICAgIGlmKGlzRG9jdW1lbnQoZWwpKSB7XG4gICAgICByZXR1cm4gJHdpbmRvdy5zY3JvbGxYIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0IHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdDtcbiAgICB9XG4gICAgcmV0dXJuIGVsLnNjcm9sbExlZnQ7XG4gIH07XG4gIHByb3RvLmR1U2Nyb2xsVG9wID0gZnVuY3Rpb24odmFsdWUsIGR1cmF0aW9uLCBlYXNpbmcpIHtcbiAgICBpZihhbmd1bGFyLmlzTnVtYmVyKHZhbHVlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuZHVTY3JvbGxUbyh0aGlzLmR1U2Nyb2xsTGVmdCgpLCB2YWx1ZSwgZHVyYXRpb24sIGVhc2luZyk7XG4gICAgfVxuICAgIHZhciBlbCA9IHVud3JhcCh0aGlzKTtcbiAgICBpZihpc0RvY3VtZW50KGVsKSkge1xuICAgICAgcmV0dXJuICR3aW5kb3cuc2Nyb2xsWSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wO1xuICAgIH1cbiAgICByZXR1cm4gZWwuc2Nyb2xsVG9wO1xuICB9O1xuXG4gIHByb3RvLmR1U2Nyb2xsVG9FbGVtZW50QW5pbWF0ZWQgPSBmdW5jdGlvbih0YXJnZXQsIG9mZnNldCwgZHVyYXRpb24sIGVhc2luZykge1xuICAgIHJldHVybiB0aGlzLmR1U2Nyb2xsVG9FbGVtZW50KHRhcmdldCwgb2Zmc2V0LCBkdXJhdGlvbiB8fCBkdVNjcm9sbER1cmF0aW9uLCBlYXNpbmcpO1xuICB9O1xuXG4gIHByb3RvLmR1U2Nyb2xsVG9wQW5pbWF0ZWQgPSBmdW5jdGlvbih0b3AsIGR1cmF0aW9uLCBlYXNpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5kdVNjcm9sbFRvcCh0b3AsIGR1cmF0aW9uIHx8IGR1U2Nyb2xsRHVyYXRpb24sIGVhc2luZyk7XG4gIH07XG5cbiAgcHJvdG8uZHVTY3JvbGxMZWZ0QW5pbWF0ZWQgPSBmdW5jdGlvbihsZWZ0LCBkdXJhdGlvbiwgZWFzaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuZHVTY3JvbGxMZWZ0KGxlZnQsIGR1cmF0aW9uIHx8IGR1U2Nyb2xsRHVyYXRpb24sIGVhc2luZyk7XG4gIH07XG5cbiAgYW5ndWxhci5mb3JFYWNoKHByb3RvLCBmdW5jdGlvbihmbiwga2V5KSB7XG4gICAgYW5ndWxhci5lbGVtZW50LnByb3RvdHlwZVtrZXldID0gZm47XG5cbiAgICAvL1JlbW92ZSBwcmVmaXggaWYgbm90IGFscmVhZHkgY2xhaW1lZCBieSBqUXVlcnkgLyB1aS51dGlsc1xuICAgIHZhciB1bnByZWZpeGVkID0ga2V5LnJlcGxhY2UoL15kdVNjcm9sbC8sICdzY3JvbGwnKTtcbiAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKGFuZ3VsYXIuZWxlbWVudC5wcm90b3R5cGVbdW5wcmVmaXhlZF0pKSB7XG4gICAgICBhbmd1bGFyLmVsZW1lbnQucHJvdG90eXBlW3VucHJlZml4ZWRdID0gZm47XG4gICAgfVxuICB9KTtcblxufV0pO1xuXG5cbi8vQWRhcHRlZCBmcm9tIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL3BhdWxpcmlzaC8xNTc5NjcxXG5hbmd1bGFyLm1vZHVsZSgnZHVTY3JvbGwucG9seWZpbGwnLCBbXSlcbi5mYWN0b3J5KCdwb2x5ZmlsbCcsIFtcIiR3aW5kb3dcIiwgZnVuY3Rpb24oJHdpbmRvdykge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIHZlbmRvcnMgPSBbJ3dlYmtpdCcsICdtb3onLCAnbycsICdtcyddO1xuXG4gIHJldHVybiBmdW5jdGlvbihmbk5hbWUsIGZhbGxiYWNrKSB7XG4gICAgaWYoJHdpbmRvd1tmbk5hbWVdKSB7XG4gICAgICByZXR1cm4gJHdpbmRvd1tmbk5hbWVdO1xuICAgIH1cbiAgICB2YXIgc3VmZml4ID0gZm5OYW1lLnN1YnN0cigwLCAxKS50b1VwcGVyQ2FzZSgpICsgZm5OYW1lLnN1YnN0cigxKTtcbiAgICBmb3IodmFyIGtleSwgaSA9IDA7IGkgPCB2ZW5kb3JzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBrZXkgPSB2ZW5kb3JzW2ldK3N1ZmZpeDtcbiAgICAgIGlmKCR3aW5kb3dba2V5XSkge1xuICAgICAgICByZXR1cm4gJHdpbmRvd1trZXldO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsbGJhY2s7XG4gIH07XG59XSk7XG5cbmFuZ3VsYXIubW9kdWxlKCdkdVNjcm9sbC5yZXF1ZXN0QW5pbWF0aW9uJywgWydkdVNjcm9sbC5wb2x5ZmlsbCddKVxuLmZhY3RvcnkoJ3JlcXVlc3RBbmltYXRpb24nLCBbXCJwb2x5ZmlsbFwiLCBcIiR0aW1lb3V0XCIsIGZ1bmN0aW9uKHBvbHlmaWxsLCAkdGltZW91dCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIGxhc3RUaW1lID0gMDtcbiAgdmFyIGZhbGxiYWNrID0gZnVuY3Rpb24oY2FsbGJhY2ssIGVsZW1lbnQpIHtcbiAgICB2YXIgY3VyclRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICB2YXIgdGltZVRvQ2FsbCA9IE1hdGgubWF4KDAsIDE2IC0gKGN1cnJUaW1lIC0gbGFzdFRpbWUpKTtcbiAgICB2YXIgaWQgPSAkdGltZW91dChmdW5jdGlvbigpIHsgY2FsbGJhY2soY3VyclRpbWUgKyB0aW1lVG9DYWxsKTsgfSxcbiAgICAgIHRpbWVUb0NhbGwpO1xuICAgIGxhc3RUaW1lID0gY3VyclRpbWUgKyB0aW1lVG9DYWxsO1xuICAgIHJldHVybiBpZDtcbiAgfTtcbiAgXG4gIHJldHVybiBwb2x5ZmlsbCgncmVxdWVzdEFuaW1hdGlvbkZyYW1lJywgZmFsbGJhY2spO1xufV0pXG4uZmFjdG9yeSgnY2FuY2VsQW5pbWF0aW9uJywgW1wicG9seWZpbGxcIiwgXCIkdGltZW91dFwiLCBmdW5jdGlvbihwb2x5ZmlsbCwgJHRpbWVvdXQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBmYWxsYmFjayA9IGZ1bmN0aW9uKHByb21pc2UpIHtcbiAgICAkdGltZW91dC5jYW5jZWwocHJvbWlzZSk7XG4gIH07XG5cbiAgcmV0dXJuIHBvbHlmaWxsKCdjYW5jZWxBbmltYXRpb25GcmFtZScsIGZhbGxiYWNrKTtcbn1dKTtcblxuXG5hbmd1bGFyLm1vZHVsZSgnZHVTY3JvbGwuc3B5QVBJJywgWydkdVNjcm9sbC5zY3JvbGxDb250YWluZXJBUEknXSlcbi5mYWN0b3J5KCdzcHlBUEknLCBbXCIkcm9vdFNjb3BlXCIsIFwiJHRpbWVvdXRcIiwgXCJzY3JvbGxDb250YWluZXJBUElcIiwgXCJkdVNjcm9sbEdyZWVkeVwiLCBcImR1U2Nyb2xsU3B5V2FpdFwiLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkdGltZW91dCwgc2Nyb2xsQ29udGFpbmVyQVBJLCBkdVNjcm9sbEdyZWVkeSwgZHVTY3JvbGxTcHlXYWl0KSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICB2YXIgY3JlYXRlU2Nyb2xsSGFuZGxlciA9IGZ1bmN0aW9uKGNvbnRleHQpIHtcbiAgICB2YXIgdGltZXIgPSBmYWxzZSwgcXVldWVkID0gZmFsc2U7XG4gICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIHF1ZXVlZCA9IGZhbHNlO1xuICAgICAgdmFyIGNvbnRhaW5lciA9IGNvbnRleHQuY29udGFpbmVyLFxuICAgICAgICAgIGNvbnRhaW5lckVsID0gY29udGFpbmVyWzBdLFxuICAgICAgICAgIGNvbnRhaW5lck9mZnNldCA9IDA7XG5cbiAgICAgIGlmICh0eXBlb2YgSFRNTEVsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGNvbnRhaW5lckVsIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQgfHwgY29udGFpbmVyRWwubm9kZVR5cGUgJiYgY29udGFpbmVyRWwubm9kZVR5cGUgPT09IGNvbnRhaW5lckVsLkVMRU1FTlRfTk9ERSkge1xuICAgICAgICBjb250YWluZXJPZmZzZXQgPSBjb250YWluZXJFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7XG4gICAgICB9XG5cbiAgICAgIHZhciBpLCBjdXJyZW50bHlBY3RpdmUsIHRvQmVBY3RpdmUsIHNwaWVzLCBzcHksIHBvcztcbiAgICAgIHNwaWVzID0gY29udGV4dC5zcGllcztcbiAgICAgIGN1cnJlbnRseUFjdGl2ZSA9IGNvbnRleHQuY3VycmVudGx5QWN0aXZlO1xuICAgICAgdG9CZUFjdGl2ZSA9IHVuZGVmaW5lZDtcblxuICAgICAgZm9yKGkgPSAwOyBpIDwgc3BpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgc3B5ID0gc3BpZXNbaV07XG4gICAgICAgIHBvcyA9IHNweS5nZXRUYXJnZXRQb3NpdGlvbigpO1xuICAgICAgICBpZiAoIXBvcykgY29udGludWU7XG5cbiAgICAgICAgaWYocG9zLnRvcCArIHNweS5vZmZzZXQgLSBjb250YWluZXJPZmZzZXQgPCAyMCAmJiAocG9zLnRvcCotMSArIGNvbnRhaW5lck9mZnNldCkgPCBwb3MuaGVpZ2h0KSB7XG4gICAgICAgICAgaWYoIXRvQmVBY3RpdmUgfHwgdG9CZUFjdGl2ZS50b3AgPCBwb3MudG9wKSB7XG4gICAgICAgICAgICB0b0JlQWN0aXZlID0ge1xuICAgICAgICAgICAgICB0b3A6IHBvcy50b3AsXG4gICAgICAgICAgICAgIHNweTogc3B5XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYodG9CZUFjdGl2ZSkge1xuICAgICAgICB0b0JlQWN0aXZlID0gdG9CZUFjdGl2ZS5zcHk7XG4gICAgICB9XG4gICAgICBpZihjdXJyZW50bHlBY3RpdmUgPT09IHRvQmVBY3RpdmUgfHwgKGR1U2Nyb2xsR3JlZWR5ICYmICF0b0JlQWN0aXZlKSkgcmV0dXJuO1xuICAgICAgaWYoY3VycmVudGx5QWN0aXZlKSB7XG4gICAgICAgIGN1cnJlbnRseUFjdGl2ZS4kZWxlbWVudC5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnZHVTY3JvbGxzcHk6YmVjYW1lSW5hY3RpdmUnLCBjdXJyZW50bHlBY3RpdmUuJGVsZW1lbnQpO1xuICAgICAgfVxuICAgICAgaWYodG9CZUFjdGl2ZSkge1xuICAgICAgICB0b0JlQWN0aXZlLiRlbGVtZW50LmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdkdVNjcm9sbHNweTpiZWNhbWVBY3RpdmUnLCB0b0JlQWN0aXZlLiRlbGVtZW50KTtcbiAgICAgIH1cbiAgICAgIGNvbnRleHQuY3VycmVudGx5QWN0aXZlID0gdG9CZUFjdGl2ZTtcbiAgICB9O1xuXG4gICAgaWYoIWR1U2Nyb2xsU3B5V2FpdCkge1xuICAgICAgcmV0dXJuIGhhbmRsZXI7XG4gICAgfVxuXG4gICAgLy9EZWJvdW5jZSBmb3IgcG90ZW50aWFsIHBlcmZvcm1hbmNlIHNhdmluZ3NcbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICBpZighdGltZXIpIHtcbiAgICAgICAgaGFuZGxlcigpO1xuICAgICAgICB0aW1lciA9ICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHRpbWVyID0gZmFsc2U7XG4gICAgICAgICAgaWYocXVldWVkKSB7XG4gICAgICAgICAgICBoYW5kbGVyKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCBkdVNjcm9sbFNweVdhaXQsIGZhbHNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHF1ZXVlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfTtcbiAgfTtcblxuICB2YXIgY29udGV4dHMgPSB7fTtcblxuICB2YXIgY3JlYXRlQ29udGV4dCA9IGZ1bmN0aW9uKCRzY29wZSkge1xuICAgIHZhciBpZCA9ICRzY29wZS4kaWQ7XG4gICAgdmFyIGNvbnRleHQgPSB7XG4gICAgICBzcGllczogW11cbiAgICB9O1xuXG4gICAgY29udGV4dC5oYW5kbGVyID0gY3JlYXRlU2Nyb2xsSGFuZGxlcihjb250ZXh0KTtcbiAgICBjb250ZXh0c1tpZF0gPSBjb250ZXh0O1xuXG4gICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcbiAgICAgIGRlc3Ryb3lDb250ZXh0KCRzY29wZSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gaWQ7XG4gIH07XG5cbiAgdmFyIGRlc3Ryb3lDb250ZXh0ID0gZnVuY3Rpb24oJHNjb3BlKSB7XG4gICAgdmFyIGlkID0gJHNjb3BlLiRpZDtcbiAgICB2YXIgY29udGV4dCA9IGNvbnRleHRzW2lkXSwgY29udGFpbmVyID0gY29udGV4dC5jb250YWluZXI7XG4gICAgaWYoY29udGFpbmVyKSB7XG4gICAgICBjb250YWluZXIub2ZmKCdzY3JvbGwnLCBjb250ZXh0LmhhbmRsZXIpO1xuICAgIH1cbiAgICBkZWxldGUgY29udGV4dHNbaWRdO1xuICB9O1xuXG4gIHZhciBkZWZhdWx0Q29udGV4dElkID0gY3JlYXRlQ29udGV4dCgkcm9vdFNjb3BlKTtcblxuICB2YXIgZ2V0Q29udGV4dEZvclNjb3BlID0gZnVuY3Rpb24oc2NvcGUpIHtcbiAgICBpZihjb250ZXh0c1tzY29wZS4kaWRdKSB7XG4gICAgICByZXR1cm4gY29udGV4dHNbc2NvcGUuJGlkXTtcbiAgICB9XG4gICAgaWYoc2NvcGUuJHBhcmVudCkge1xuICAgICAgcmV0dXJuIGdldENvbnRleHRGb3JTY29wZShzY29wZS4kcGFyZW50KTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbnRleHRzW2RlZmF1bHRDb250ZXh0SWRdO1xuICB9O1xuXG4gIHZhciBnZXRDb250ZXh0Rm9yU3B5ID0gZnVuY3Rpb24oc3B5KSB7XG4gICAgdmFyIGNvbnRleHQsIGNvbnRleHRJZCwgc2NvcGUgPSBzcHkuJGVsZW1lbnQuc2NvcGUoKTtcbiAgICBpZihzY29wZSkge1xuICAgICAgcmV0dXJuIGdldENvbnRleHRGb3JTY29wZShzY29wZSk7XG4gICAgfVxuICAgIC8vTm8gc2NvcGUsIG1vc3QgbGlrZWx5IGRlc3Ryb3llZFxuICAgIGZvcihjb250ZXh0SWQgaW4gY29udGV4dHMpIHtcbiAgICAgIGNvbnRleHQgPSBjb250ZXh0c1tjb250ZXh0SWRdO1xuICAgICAgaWYoY29udGV4dC5zcGllcy5pbmRleE9mKHNweSkgIT09IC0xKSB7XG4gICAgICAgIHJldHVybiBjb250ZXh0O1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICB2YXIgaXNFbGVtZW50SW5Eb2N1bWVudCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICB3aGlsZSAoZWxlbWVudC5wYXJlbnROb2RlKSB7XG4gICAgICBlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlO1xuICAgICAgaWYgKGVsZW1lbnQgPT09IGRvY3VtZW50KSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgdmFyIGFkZFNweSA9IGZ1bmN0aW9uKHNweSkge1xuICAgIHZhciBjb250ZXh0ID0gZ2V0Q29udGV4dEZvclNweShzcHkpO1xuICAgIGlmICghY29udGV4dCkgcmV0dXJuO1xuICAgIGNvbnRleHQuc3BpZXMucHVzaChzcHkpO1xuICAgIGlmICghY29udGV4dC5jb250YWluZXIgfHwgIWlzRWxlbWVudEluRG9jdW1lbnQoY29udGV4dC5jb250YWluZXIpKSB7XG4gICAgICBpZihjb250ZXh0LmNvbnRhaW5lcikge1xuICAgICAgICBjb250ZXh0LmNvbnRhaW5lci5vZmYoJ3Njcm9sbCcsIGNvbnRleHQuaGFuZGxlcik7XG4gICAgICB9XG4gICAgICBjb250ZXh0LmNvbnRhaW5lciA9IHNjcm9sbENvbnRhaW5lckFQSS5nZXRDb250YWluZXIoc3B5LiRlbGVtZW50LnNjb3BlKCkpO1xuICAgICAgY29udGV4dC5jb250YWluZXIub24oJ3Njcm9sbCcsIGNvbnRleHQuaGFuZGxlcikudHJpZ2dlckhhbmRsZXIoJ3Njcm9sbCcpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgcmVtb3ZlU3B5ID0gZnVuY3Rpb24oc3B5KSB7XG4gICAgdmFyIGNvbnRleHQgPSBnZXRDb250ZXh0Rm9yU3B5KHNweSk7XG4gICAgaWYoc3B5ID09PSBjb250ZXh0LmN1cnJlbnRseUFjdGl2ZSkge1xuICAgICAgY29udGV4dC5jdXJyZW50bHlBY3RpdmUgPSBudWxsO1xuICAgIH1cbiAgICB2YXIgaSA9IGNvbnRleHQuc3BpZXMuaW5kZXhPZihzcHkpO1xuICAgIGlmKGkgIT09IC0xKSB7XG4gICAgICBjb250ZXh0LnNwaWVzLnNwbGljZShpLCAxKTtcbiAgICB9XG5cdFx0c3B5LiRlbGVtZW50ID0gbnVsbDtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGFkZFNweTogYWRkU3B5LFxuICAgIHJlbW92ZVNweTogcmVtb3ZlU3B5LFxuICAgIGNyZWF0ZUNvbnRleHQ6IGNyZWF0ZUNvbnRleHQsXG4gICAgZGVzdHJveUNvbnRleHQ6IGRlc3Ryb3lDb250ZXh0LFxuICAgIGdldENvbnRleHRGb3JTY29wZTogZ2V0Q29udGV4dEZvclNjb3BlXG4gIH07XG59XSk7XG5cblxuYW5ndWxhci5tb2R1bGUoJ2R1U2Nyb2xsLnNjcm9sbENvbnRhaW5lckFQSScsIFtdKVxuLmZhY3RvcnkoJ3Njcm9sbENvbnRhaW5lckFQSScsIFtcIiRkb2N1bWVudFwiLCBmdW5jdGlvbigkZG9jdW1lbnQpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBjb250YWluZXJzID0ge307XG5cbiAgdmFyIHNldENvbnRhaW5lciA9IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50KSB7XG4gICAgdmFyIGlkID0gc2NvcGUuJGlkO1xuICAgIGNvbnRhaW5lcnNbaWRdID0gZWxlbWVudDtcbiAgICByZXR1cm4gaWQ7XG4gIH07XG5cbiAgdmFyIGdldENvbnRhaW5lcklkID0gZnVuY3Rpb24oc2NvcGUpIHtcbiAgICBpZihjb250YWluZXJzW3Njb3BlLiRpZF0pIHtcbiAgICAgIHJldHVybiBzY29wZS4kaWQ7XG4gICAgfVxuICAgIGlmKHNjb3BlLiRwYXJlbnQpIHtcbiAgICAgIHJldHVybiBnZXRDb250YWluZXJJZChzY29wZS4kcGFyZW50KTtcbiAgICB9XG4gICAgcmV0dXJuO1xuICB9O1xuXG4gIHZhciBnZXRDb250YWluZXIgPSBmdW5jdGlvbihzY29wZSkge1xuICAgIHZhciBpZCA9IGdldENvbnRhaW5lcklkKHNjb3BlKTtcbiAgICByZXR1cm4gaWQgPyBjb250YWluZXJzW2lkXSA6ICRkb2N1bWVudDtcbiAgfTtcblxuICB2YXIgcmVtb3ZlQ29udGFpbmVyID0gZnVuY3Rpb24oc2NvcGUpIHtcbiAgICB2YXIgaWQgPSBnZXRDb250YWluZXJJZChzY29wZSk7XG4gICAgaWYoaWQpIHtcbiAgICAgIGRlbGV0ZSBjb250YWluZXJzW2lkXTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRDb250YWluZXJJZDogICBnZXRDb250YWluZXJJZCwgXG4gICAgZ2V0Q29udGFpbmVyOiAgICAgZ2V0Q29udGFpbmVyLCBcbiAgICBzZXRDb250YWluZXI6ICAgICBzZXRDb250YWluZXIsXG4gICAgcmVtb3ZlQ29udGFpbmVyOiAgcmVtb3ZlQ29udGFpbmVyXG4gIH07XG59XSk7XG5cblxuYW5ndWxhci5tb2R1bGUoJ2R1U2Nyb2xsLnNtb290aFNjcm9sbCcsIFsnZHVTY3JvbGwuc2Nyb2xsSGVscGVycycsICdkdVNjcm9sbC5zY3JvbGxDb250YWluZXJBUEknXSlcbi5kaXJlY3RpdmUoJ2R1U21vb3RoU2Nyb2xsJywgW1wiZHVTY3JvbGxEdXJhdGlvblwiLCBcImR1U2Nyb2xsT2Zmc2V0XCIsIFwic2Nyb2xsQ29udGFpbmVyQVBJXCIsIGZ1bmN0aW9uKGR1U2Nyb2xsRHVyYXRpb24sIGR1U2Nyb2xsT2Zmc2V0LCBzY3JvbGxDb250YWluZXJBUEkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHJldHVybiB7XG4gICAgbGluayA6IGZ1bmN0aW9uKCRzY29wZSwgJGVsZW1lbnQsICRhdHRyKSB7XG4gICAgICAkZWxlbWVudC5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmKCEkYXR0ci5ocmVmIHx8ICRhdHRyLmhyZWYuaW5kZXhPZignIycpID09PSAtMSkgcmV0dXJuO1xuXG4gICAgICAgIHZhciB0YXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgkYXR0ci5ocmVmLnJlcGxhY2UoLy4qKD89I1teXFxzXSskKS8sICcnKS5zdWJzdHJpbmcoMSkpO1xuICAgICAgICBpZighdGFyZ2V0IHx8ICF0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KSByZXR1cm47XG4gICAgICAgIFxuICAgICAgICBpZiAoZS5zdG9wUHJvcGFnYXRpb24pIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGlmIChlLnByZXZlbnREZWZhdWx0KSBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgdmFyIG9mZnNldCAgICA9ICRhdHRyLm9mZnNldCA/IHBhcnNlSW50KCRhdHRyLm9mZnNldCwgMTApIDogZHVTY3JvbGxPZmZzZXQ7XG4gICAgICAgIHZhciBkdXJhdGlvbiAgPSAkYXR0ci5kdXJhdGlvbiA/IHBhcnNlSW50KCRhdHRyLmR1cmF0aW9uLCAxMCkgOiBkdVNjcm9sbER1cmF0aW9uO1xuICAgICAgICB2YXIgY29udGFpbmVyID0gc2Nyb2xsQ29udGFpbmVyQVBJLmdldENvbnRhaW5lcigkc2NvcGUpO1xuXG4gICAgICAgIGNvbnRhaW5lci5kdVNjcm9sbFRvRWxlbWVudChcbiAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQodGFyZ2V0KSwgXG4gICAgICAgICAgaXNOYU4ob2Zmc2V0KSA/IDAgOiBvZmZzZXQsIFxuICAgICAgICAgIGlzTmFOKGR1cmF0aW9uKSA/IDAgOiBkdXJhdGlvblxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xufV0pO1xuXG5cbmFuZ3VsYXIubW9kdWxlKCdkdVNjcm9sbC5zcHlDb250ZXh0JywgWydkdVNjcm9sbC5zcHlBUEknXSlcbi5kaXJlY3RpdmUoJ2R1U3B5Q29udGV4dCcsIFtcInNweUFQSVwiLCBmdW5jdGlvbihzcHlBUEkpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHJldHVybiB7XG4gICAgcmVzdHJpY3Q6ICdBJyxcbiAgICBzY29wZTogdHJ1ZSxcbiAgICBjb21waWxlOiBmdW5jdGlvbiBjb21waWxlKHRFbGVtZW50LCB0QXR0cnMsIHRyYW5zY2x1ZGUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByZTogZnVuY3Rpb24gcHJlTGluaygkc2NvcGUsIGlFbGVtZW50LCBpQXR0cnMsIGNvbnRyb2xsZXIpIHtcbiAgICAgICAgICBzcHlBUEkuY3JlYXRlQ29udGV4dCgkc2NvcGUpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgfTtcbn1dKTtcblxuXG5hbmd1bGFyLm1vZHVsZSgnZHVTY3JvbGwuc2Nyb2xsQ29udGFpbmVyJywgWydkdVNjcm9sbC5zY3JvbGxDb250YWluZXJBUEknXSlcbi5kaXJlY3RpdmUoJ2R1U2Nyb2xsQ29udGFpbmVyJywgW1wic2Nyb2xsQ29udGFpbmVyQVBJXCIsIGZ1bmN0aW9uKHNjcm9sbENvbnRhaW5lckFQSSl7XG4gICd1c2Ugc3RyaWN0JztcblxuICByZXR1cm4ge1xuICAgIHJlc3RyaWN0OiAnQScsXG4gICAgc2NvcGU6IHRydWUsXG4gICAgY29tcGlsZTogZnVuY3Rpb24gY29tcGlsZSh0RWxlbWVudCwgdEF0dHJzLCB0cmFuc2NsdWRlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwcmU6IGZ1bmN0aW9uIHByZUxpbmsoJHNjb3BlLCBpRWxlbWVudCwgaUF0dHJzLCBjb250cm9sbGVyKSB7XG4gICAgICAgICAgaUF0dHJzLiRvYnNlcnZlKCdkdVNjcm9sbENvbnRhaW5lcicsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNTdHJpbmcoZWxlbWVudCkpIHtcbiAgICAgICAgICAgICAgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbGVtZW50ID0gKGFuZ3VsYXIuaXNFbGVtZW50KGVsZW1lbnQpID8gYW5ndWxhci5lbGVtZW50KGVsZW1lbnQpIDogaUVsZW1lbnQpO1xuICAgICAgICAgICAgc2Nyb2xsQ29udGFpbmVyQVBJLnNldENvbnRhaW5lcigkc2NvcGUsIGVsZW1lbnQpO1xuICAgICAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgc2Nyb2xsQ29udGFpbmVyQVBJLnJlbW92ZUNvbnRhaW5lcigkc2NvcGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9O1xufV0pO1xuXG5cbmFuZ3VsYXIubW9kdWxlKCdkdVNjcm9sbC5zY3JvbGxzcHknLCBbJ2R1U2Nyb2xsLnNweUFQSSddKVxuLmRpcmVjdGl2ZSgnZHVTY3JvbGxzcHknLCBbXCJzcHlBUElcIiwgXCJkdVNjcm9sbE9mZnNldFwiLCBcIiR0aW1lb3V0XCIsIFwiJHJvb3RTY29wZVwiLCBmdW5jdGlvbihzcHlBUEksIGR1U2Nyb2xsT2Zmc2V0LCAkdGltZW91dCwgJHJvb3RTY29wZSkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIFNweSA9IGZ1bmN0aW9uKHRhcmdldEVsZW1lbnRPcklkLCAkZWxlbWVudCwgb2Zmc2V0KSB7XG4gICAgaWYoYW5ndWxhci5pc0VsZW1lbnQodGFyZ2V0RWxlbWVudE9ySWQpKSB7XG4gICAgICB0aGlzLnRhcmdldCA9IHRhcmdldEVsZW1lbnRPcklkO1xuICAgIH0gZWxzZSBpZihhbmd1bGFyLmlzU3RyaW5nKHRhcmdldEVsZW1lbnRPcklkKSkge1xuICAgICAgdGhpcy50YXJnZXRJZCA9IHRhcmdldEVsZW1lbnRPcklkO1xuICAgIH1cbiAgICB0aGlzLiRlbGVtZW50ID0gJGVsZW1lbnQ7XG4gICAgdGhpcy5vZmZzZXQgPSBvZmZzZXQ7XG4gIH07XG5cbiAgU3B5LnByb3RvdHlwZS5nZXRUYXJnZXRFbGVtZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLnRhcmdldCAmJiB0aGlzLnRhcmdldElkKSB7XG4gICAgICB0aGlzLnRhcmdldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudGFyZ2V0SWQpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy50YXJnZXQ7XG4gIH07XG5cbiAgU3B5LnByb3RvdHlwZS5nZXRUYXJnZXRQb3NpdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciB0YXJnZXQgPSB0aGlzLmdldFRhcmdldEVsZW1lbnQoKTtcbiAgICBpZih0YXJnZXQpIHtcbiAgICAgIHJldHVybiB0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgfVxuICB9O1xuXG4gIFNweS5wcm90b3R5cGUuZmx1c2hUYXJnZXRDYWNoZSA9IGZ1bmN0aW9uKCkge1xuICAgIGlmKHRoaXMudGFyZ2V0SWQpIHtcbiAgICAgIHRoaXMudGFyZ2V0ID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGxpbms6IGZ1bmN0aW9uICgkc2NvcGUsICRlbGVtZW50LCAkYXR0cikge1xuICAgICAgdmFyIGhyZWYgPSAkYXR0ci5uZ0hyZWYgfHwgJGF0dHIuaHJlZjtcbiAgICAgIHZhciB0YXJnZXRJZDtcblxuICAgICAgaWYgKGhyZWYgJiYgaHJlZi5pbmRleE9mKCcjJykgIT09IC0xKSB7XG4gICAgICAgIHRhcmdldElkID0gaHJlZi5yZXBsYWNlKC8uKig/PSNbXlxcc10rJCkvLCAnJykuc3Vic3RyaW5nKDEpO1xuICAgICAgfSBlbHNlIGlmKCRhdHRyLmR1U2Nyb2xsc3B5KSB7XG4gICAgICAgIHRhcmdldElkID0gJGF0dHIuZHVTY3JvbGxzcHk7XG4gICAgICB9XG4gICAgICBpZighdGFyZ2V0SWQpIHJldHVybjtcblxuICAgICAgLy8gUnVuIHRoaXMgaW4gdGhlIG5leHQgZXhlY3V0aW9uIGxvb3Agc28gdGhhdCB0aGUgc2Nyb2xsIGNvbnRleHQgaGFzIGEgY2hhbmNlXG4gICAgICAvLyB0byBpbml0aWFsaXplXG4gICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNweSA9IG5ldyBTcHkodGFyZ2V0SWQsICRlbGVtZW50LCAtKCRhdHRyLm9mZnNldCA/IHBhcnNlSW50KCRhdHRyLm9mZnNldCwgMTApIDogZHVTY3JvbGxPZmZzZXQpKTtcbiAgICAgICAgc3B5QVBJLmFkZFNweShzcHkpO1xuXG4gICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgc3B5QVBJLnJlbW92ZVNweShzcHkpO1xuICAgICAgICB9KTtcbiAgICAgICAgJHNjb3BlLiRvbignJGxvY2F0aW9uQ2hhbmdlU3VjY2VzcycsIHNweS5mbHVzaFRhcmdldENhY2hlLmJpbmQoc3B5KSk7XG4gICAgICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdWNjZXNzJywgc3B5LmZsdXNoVGFyZ2V0Q2FjaGUuYmluZChzcHkpKTtcbiAgICAgIH0sIDAsIGZhbHNlKTtcbiAgICB9XG4gIH07XG59XSk7XG4iLCIvKmdsb2JhbCBhbmd1bGFyKi9cbid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ21lbXJ5JywgWyduZ1JvdXRlJywgJ2R1U2Nyb2xsJ10pO1xuIiwiLypnbG9iYWwgYW5ndWxhciovXG5cbmFuZ3VsYXIubW9kdWxlKCdtZW1yeScpXG4gIC5jb25maWcoZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgICRyb3V0ZVByb3ZpZGVyXG4gICAgICAud2hlbignLycsIHtcbiAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9tYWluLmh0bWwnXG4gICAgICB9KTtcbiAgfSlcbjsiLCIvKmdsb2JhbCBhbmd1bGFyKi9cblxuYW5ndWxhci5tb2R1bGUoJ21lbXJ5JylcbiAgLmNvbnRyb2xsZXIoJ0RlZmluaXRpb25Gb3JtQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsIGRlZk1vZGVsLCBzY3JvbGxUb0RlZikge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICAkc2NvcGUuaGlkZURlc2NyaXB0aW9uID0gdHJ1ZTtcbiAgICAkc2NvcGUudGl0bGVDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBmb3VuZFRpdGxlSUQgPSBkZWZNb2RlbC5maW5kSURCeVRpdGxlU3Vic3RyKCRzY29wZS50aXRsZSk7XG4gICAgICBzY3JvbGxUb0RlZi5ieUlEKGZvdW5kVGl0bGVJRCk7XG4gICAgICAkc2NvcGUuaGlkZURlc2NyaXB0aW9uID0gKGZvdW5kVGl0bGVJRCB8fCAkc2NvcGUudGl0bGUgPT09ICcnKTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnRpdGxlSW5wdXRCZWdpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgc2Nyb2xsVG9EZWYucmVzZXRJRCgpO1xuICAgIH07XG5cbiAgICAkc2NvcGUudGl0bGVJbnB1dEVuZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgc2Nyb2xsVG9EZWYucmVzZXRJRCgpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuYWRkRGVmaW5pdGlvbiA9IGZ1bmN0aW9uKCl7XG4gICAgICBpZiAoJHNjb3BlLnRpdGxlICYmICRzY29wZS5kZXNjcmlwdGlvbikge1xuICAgICAgICBkZWZNb2RlbC5hZGREZWZpbml0aW9uKCRzY29wZS50aXRsZSwgJHNjb3BlLmRlc2NyaXB0aW9uKTtcblxuICAgICAgICAvL2JsYW5rIG91dCB0aGUgZm9ybVxuICAgICAgICAkc2NvcGUudGl0bGUgPSAnJztcbiAgICAgICAgJHNjb3BlLmRlc2NyaXB0aW9uID0gJyc7XG4gICAgICAgICRzY29wZS5oaWRlRGVzY3JpcHRpb24gPSB0cnVlO1xuICAgICAgfVxuICAgIH07XG4gIH0pXG47IiwiLypnbG9iYWwgYW5ndWxhciovXG5cbmFuZ3VsYXIubW9kdWxlKCdtZW1yeScpXG4gIC5jb250cm9sbGVyKCdEZWZpbml0aW9uTGlzdENvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCBkZWZNb2RlbCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIC8vYXV0b21hdGljYWxseSB1cGRhdGUgdGhlIGRlZiBsaXN0IHdoZW4gdGhlIG1vZGVsIGNoYW5nZXNcbiAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRlZk1vZGVsLmRhdGEuZGVmczsgfSwgZnVuY3Rpb24gKG5ld1ZhbCkge1xuICAgICAgaWYgKHR5cGVvZiBuZXdWYWwgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICRzY29wZS5kZWZpbml0aW9ucyA9IGRlZk1vZGVsLmRhdGEuZGVmcztcbiAgICAgIH1cbiAgICB9KTtcblxuICAgICRzY29wZS50dXJuT25FZGl0TW9kZSA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAkc2NvcGUuZGVmaW5pdGlvbnMuZm9yRWFjaChmdW5jdGlvbihkKSB7XG4gICAgICAgIGQuZWRpdE1vZGUgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgICAgJHNjb3BlLmRlZmluaXRpb25zW2luZGV4XS5lZGl0TW9kZSA9IHRydWU7XG4gICAgfTtcblxuICAgICRzY29wZS50dXJuT2ZmRWRpdE1vZGUgPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgJHNjb3BlLmRlZmluaXRpb25zW2luZGV4XS5lZGl0TW9kZSA9IGZhbHNlO1xuICAgIH07XG5cbiAgICAvL3RvZG8gbmVlZCB0byBlaXRoZXIgcGFzcyBkZWZfaWQgb3IgZmluZCBhIHZlcnNpb24gb2YgJGluZGV4IHRoYXQgdHJhY2tzIHRoZSB1bnNvcnRlZCBvcmRlci4gb3IgYWxwaGEgc29ydCBpbiB0aGUgZGF0YWJhc2UgKG9yIGluIHRoZSByZXRyaWV2ZWQgdmVyc2lvbiEpXG4gICAgJHNjb3BlLmVkaXREZWZpbml0aW9uID0gZnVuY3Rpb24oaW5kZXgsIGRlZikge1xuICAgICAgJHNjb3BlLnR1cm5PZmZFZGl0TW9kZShpbmRleCk7XG4gICAgICAvL3RlbXBvcmFyaWx5IGNoYW5nZSB0aGUgdmlzaWJsZSBkZXNjcmlwdGlvbiBzbyB0aGVyZSdzIGltbWVkaWF0ZSB1cGRhdGUgYmVmb3JlIHNlcnZlciByZXNwb25kc1xuICAgICAgLy8kc2NvcGUuZGVmaW5pdGlvbnNbaW5kZXhdLmRlc2NyaXB0aW9uVVJMID0gJHNjb3BlLmRlZmluaXRpb25zW2luZGV4XS5kZXNjcmlwdGlvbjtcbiAgICAgIGRlZk1vZGVsLmVkaXREZWZpbml0aW9uKGRlZik7XG4gICAgfTtcblxuICAgICRzY29wZS5kZWxEZWZpbml0aW9uID0gZnVuY3Rpb24oaWQpe1xuICAgICAgZGVmTW9kZWwuZGVsZXRlRGVmaW5pdGlvbihpZCk7XG4gICAgfTtcbiAgfSlcbjsiLCIvKmdsb2JhbCBhbmd1bGFyKi9cblxuYW5ndWxhci5tb2R1bGUoJ21lbXJ5JylcbiAgLmNvbnRyb2xsZXIoJ01haW5Db250cm9sbGVyJywgZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgfSlcbjsiLCIvKmdsb2JhbCBhbmd1bGFyKi9cblxuYW5ndWxhci5tb2R1bGUoJ21lbXJ5JylcbiAgLmZhY3RvcnkoJ2RlZk1vZGVsJywgZnVuY3Rpb24gKCRxLCBkZWZTZXJ2ZXIpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgLy9wdWJsaWMgbWV0aG9kc1xuICAgIHZhciBhcGkgPSB7fTtcbiAgICAvL3B1YmxpYyBkYXRhXG4gICAgYXBpLmRhdGEgPSB7fTtcbiAgICAvL3ByaXZhdGUgZGF0YS4gTm9uZSB5ZXRcbiAgICAvL3ZhciBkYXRhID0ge307XG5cbiAgICAvL2NvbnN0cnVjdG9yXG4gICAgZnVuY3Rpb24gY29uc3RydWN0b3IoKSB7XG4gICAgICBkZWZTZXJ2ZXIuZ2V0QWxsKClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgYXBpLmRhdGEuZGVmcyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFwaS5nZXREZWZzID0gZnVuY3Rpb24gKCkge1xuICAgICAgLy90b2RvIHRoaXMgaXMgZG9pbmcgdGhlIHNhbWUgdGhpbmcgYXMgdGhlIGNvbnN0cnVjdG9yXG4gICAgICB2YXIgcHJvbWlzZSA9IGRlZlNlcnZlci5nZXRBbGwoKTtcbiAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgYXBpLmRhdGEuZGVmcyA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBwcm9taXNlO1xuICAgIH07XG5cbiAgICAvKlxuICAgICMgYWRkRGVmaW5pdGlvblxuICAgICovXG4gICAgYXBpLmFkZERlZmluaXRpb24gPSBmdW5jdGlvbiAodGl0bGUsIGRlc2NyaXB0aW9uKSB7XG4gICAgICBkZWZTZXJ2ZXIuY3JlYXRlKHtcbiAgICAgICAgdGl0bGU6IHRpdGxlLFxuICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb25cbiAgICAgIH0pXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgIGFwaS5nZXREZWZzKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAvKlxuICAgICMgZWRpdERlZmluaXRpb25cbiAgICAqL1xuICAgIGFwaS5lZGl0RGVmaW5pdGlvbiA9IGZ1bmN0aW9uIChkZWZpbml0aW9uKSB7XG4gICAgICBkZWZTZXJ2ZXIudXBkYXRlKGRlZmluaXRpb24pXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgIC8vdG9kbzogZG9uJ3QgcmVxdWlyZSBhIHNlcnZlciBnZXQgZXZlcnkgdGltZSB3ZSBjaGFuZ2UgdGhlIGRhdGFcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICBhcGkuZ2V0RGVmcygpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLypcbiAgICAgIyBkZWxldGVEZWZpbml0aW9uXG4gICAgICovXG4gICAgYXBpLmRlbGV0ZURlZmluaXRpb24gPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgIGRlZlNlcnZlci5kZWxldGUoaWQpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgIC8vdG9kbzogZG9uJ3QgcmVxdWlyZSBhIHNlcnZlciBnZXQgZXZlcnkgdGltZSB3ZSBjaGFuZ2UgdGhlIGRhdGFcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICBhcGkuZ2V0RGVmcygpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLypcbiAgICAjIGZpbmRJREJ5VGl0bGVTdWJzdHJcbiAgICByZXR1cm5zIHRoZSBpZCBvZiB0aGUgZmlyc3QgZGVmaW5pdGlvbiB3aG9zZSB0aXRsZSBiZWdpbnMgd2l0aCB0aGUgc3Vic3RyaW5nLlxuICAgIHJlbGllcyBvbiB0aGUgc2VydmVyIHJldHVybmluZyB0aGUgZGVmcyBzb3J0ZWQgYWxwaGFiZXRpY2FsbHkgYnkgdGl0bGVcbiAgICAqL1xuICAgIGFwaS5maW5kSURCeVRpdGxlU3Vic3RyID0gZnVuY3Rpb24gKHRpdGxlU3Vic3RyKSB7XG4gICAgICAvL2lucHV0IHZhbGlkYXRpb25cbiAgICAgIGlmICh0eXBlb2YgdGl0bGVTdWJzdHIgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignZmluZElEQnlUaXRsZVN1YnN0ciByZXF1aXJlcyBzdHJpbmcgaW5wdXQnKTtcbiAgICAgIH1cbiAgICAgIHZhciBmb3VuZFRpdGxlSUQgPSBudWxsO1xuICAgICAgYXBpLmRhdGEuZGVmcy5mb3JFYWNoKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHZhciBpbmRleCA9IGQudGl0bGUuaW5kZXhPZih0aXRsZVN1YnN0cik7XG4gICAgICAgIC8vaWYgaW5kZXggaXMgMCwgd2UgZm91bmQgYSBtYXRjaGluZyB0aXRsZVxuICAgICAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgICAgICBmb3VuZFRpdGxlSUQgPSBkLl9pZDtcbiAgICAgICAgICAvL2VuZCB0aGUgZm9yRWFjaCBsb29wXG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gZm91bmRUaXRsZUlEO1xuICAgIH07XG5cbiAgICBjb25zdHJ1Y3RvcigpO1xuXG4gICAgcmV0dXJuIGFwaTtcbiAgfSlcbjsiLCIvKmdsb2JhbCBhbmd1bGFyKi9cblxuYW5ndWxhci5tb2R1bGUoJ21lbXJ5JylcbiAgLmZhY3RvcnkoJ2RlZlNlcnZlcicsIGZ1bmN0aW9uICgkaHR0cCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICByZXR1cm4ge1xuICAgICAgZ2V0QWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9kZWZzJyk7XG4gICAgICB9LFxuXG4gICAgICBnZXRPbmU6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL2RlZnMvJyArIGlkKTtcbiAgICAgIH0sXG5cbiAgICAgIGNyZWF0ZTogZnVuY3Rpb24gKGRlZikge1xuICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9kZWZzJywgZGVmKTtcbiAgICAgIH0sXG5cbiAgICAgIHVwZGF0ZTogZnVuY3Rpb24gKGRlZikge1xuICAgICAgICByZXR1cm4gJGh0dHAucHV0KCcvYXBpL2RlZnMvJyArIGRlZi5faWQsIGRlZik7XG4gICAgICB9LFxuXG4gICAgICBkZWxldGU6IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKCcvYXBpL2RlZnMvJyArIGlkKTtcbiAgICAgIH1cbiAgICB9O1xuICB9KVxuOyIsIi8qZ2xvYmFsIGFuZ3VsYXIsZG9jdW1lbnQqL1xuXG5hbmd1bGFyLm1vZHVsZSgnbWVtcnknKVxuICAuZmFjdG9yeSgnc2Nyb2xsVG9EZWYnLCBmdW5jdGlvbiAoJGRvY3VtZW50LCBkZWZNb2RlbCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgICAvL3B1YmxpYyBtZXRob2RzXG4gICAgdmFyIGFwaSA9IHt9O1xuICAgIC8vcHJpdmF0ZSBkYXRhXG4gICAgdmFyIGRhdGEgPSB7fTtcblxuICAgIGRhdGEuY3VycmVudFNjcm9sbERlZklEID0gbnVsbDtcblxuICAgIGFwaS5ieUlEID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICBpZiAoZGF0YS5jdXJyZW50U2Nyb2xsRGVmSUQgIT09IGlkKSB7XG4gICAgICAgIGRhdGEuY3VycmVudFNjcm9sbERlZklEID0gaWQ7XG4gICAgICAgIHZhciBkZWZFbGVtZW50ID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSk7XG4gICAgICAgICRkb2N1bWVudC5zY3JvbGxUbyhkZWZFbGVtZW50LCAwLCAxMDAwKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgYXBpLmJ5VGl0bGUgPSBmdW5jdGlvbiAodGl0bGUpIHtcbiAgICAgIC8vaW5wdXQgdmFsaWRhdGlvblxuICAgICAgaWYgKHR5cGVvZiB0aXRsZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzY3JvbGxUb0RlZi5ieVRpdGxlIHJlcXVpcmVzIHN0cmluZyBpbnB1dCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGl0bGUgIT09ICcnKSB7XG4gICAgICAgIHZhciBpZCA9IGRlZk1vZGVsLmZpbmRJREJ5VGl0bGVTdWJzdHIodGl0bGUpO1xuICAgICAgICBpZiAoaWQpIHtcbiAgICAgICAgICBhcGkuYnlJRChpZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgYXBpLnJlc2V0SUQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBkYXRhLmN1cnJlbnRTY3JvbGxEZWZJRCA9IG51bGw7XG4gICAgfTtcblxuICAgIHJldHVybiBhcGk7XG4gIH0pXG47Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9